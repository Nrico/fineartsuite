<!DOCTYPE html>
<html>
<head>
  <title>Manage Artists</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <h1>Artist Management</h1>
  <% if (flash.error && flash.error.length) { %>
    <p style="color:red"><%= flash.error[0] %></p>
  <% } %>
  <% if (flash.success && flash.success.length) { %>
    <p style="color:green"><%= flash.success[0] %></p>
  <% } %>
  <form id="add-artist" method="post" action="/dashboard/artists">
    <label>ID <input type="text" name="id" required></label><br>
    <label>Gallery Slug <input type="text" name="gallery_slug" required></label><br>
    <label>Name <input type="text" name="name" required></label><br>
    <label>Bio <input type="text" name="bio" required></label><br>
    <button type="submit">Add Artist</button>
  </form>
  <h2>Existing Artists</h2>
  <ul>
    <% artists.forEach(function(a){ %>
      <li>
        <form class="artist-form" data-id="<%= a.id %>">
          <input name="name" value="<%= a.name %>">
          <input name="bio" value="<%= a.bio %>">
          <button type="submit">Save</button>
          <button type="button" class="delete">Delete</button>
        </form>
        (<%= a.gallery_slug %>)
      </li>
    <% }) %>
  </ul>
  <p><a href="/dashboard">Back to dashboard</a></p>
  <script>
    document.querySelectorAll('.artist-form').forEach(f => {
      const id = f.dataset.id;
      f.addEventListener('submit', async e => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(f).entries());
        await fetch('/dashboard/artists/' + id, {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        location.reload();
      });
      f.querySelector('.delete').addEventListener('click', async e => {
        e.preventDefault();
        await fetch('/dashboard/artists/' + id, { method: 'DELETE' });
        location.reload();
      });
    });
  </script>
</body>
</html>
